<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
	<style>
.topnav {
  overflow: hidden;
  background-color: #e9e9e9;
}

.topnav a {
  float: left;
  display: block;
  color: black;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
  font-size: 17px;
}

.topnav a:hover {
  background-color: #ddd;
  color: black;
}

.topnav a.active {
  background-color: #2196F3;
  color: white;
}

.topnav .search-container {
  float: right;
}

.topnav input[type=text] {
  padding: 6px;
  margin-top: 8px;
  font-size: 17px;
  border: none;
}

.topnav .search-container button {
  float: right;
  padding: 6px;
  margin-top: 8px;
  margin-right: 16px;
  background: #ddd;
  font-size: 17px;
  border: none;
  cursor: pointer;
}

.topnav .search-container button:hover {
  background: #ccc;
}


@media screen and (max-width: 600px) {
  .topnav .search-container {
    float: none;
  }
  .topnav a, .topnav input[type=text], .topnav .search-container button {
    float: none;
    display: block;
    text-align: left;
    width: 100%;
    margin: 0;
    padding: 14px;
  }

  .topnav input[type=text] {
    border: 1px solid #ccc;  
  }
}
}
	</style>
	<script>
		function initialize()
		{
			AnimeInfo = document.getElementById("Info");
			AnimeInfo1 = document.getElementById("Info1");
			ImageInfo = document.getElementById("imgInfo");
			newDesc = "";
			newTitle = "";
			newImage = "";
			fetch(url, options).then(handleResponse)
                   .then(handleData)
                   .catch(handleError);
			display();
		}
		function display()
		{
			AnimeInfo.innerHTML = newTitle;
			AnimeInfo1.innerHTML = newDesc;
			ImageInfo.src = newImage;
		}
		var query = `
query ($id: Int, $search: String) { # Define which variables will be used in the query (id)
  Media (id: $id, search: $search, type: ANIME) { # Insert our variables into the query arguments (id) (type: ANIME is hard-coded in the query)
	coverImage {
      large
    }
    id
    title {
      romaji
      english
      native
    }
	description
  }
}
`;


var variables = {
    search: "your lie in april"
};


var url = 'https://graphql.anilist.co',
    options = {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json',
        },
        body: JSON.stringify({
            query: query,
            variables: variables
        })
    };


function handleResponse(response) {
    return response.json().then(function (json) {
        return response.ok ? json : Promise.reject(json);
    });
}

function handleData(data) {
    console.log(data);
	newData = (JSON.stringify(data, null, 4));
	seperateData(newData);
	display();
}

function seperateData(newData)
{
	temp = newData.indexOf("title");
	temp2 = newData.indexOf("description");
	newTitle = newData.substring(temp-1,temp2);
	temp = newData.indexOf("description");
	newDesc = newData.substring(temp-1);
	temp3 = newData.indexOf("large");
	temp = newData.indexOf("id");
	newImage = newData.substring(temp3+9,temp-30);
	console.log(newImage);
}
function handleError(error) {
    alert('Error, check console');
    console.error(error);
}
function changeSearch(newSearch)
{
	console.log(newSearch);
	variables = { 
		search: newSearch
	}
	fetch(url, options).then(handleResponse)
                   .then(handleData)
                   .catch(handleError);
}
	</script>
</head>
<body onload = "initialize();">
		<div class="topnav">
		<a class="active" href="#home">Home</a>
	<div class="search-container">
    <form action = "search.html" method = "get">
      <input type="text" placeholder="Search Anime/Manga" name="newSearch">
	  <button type="submit" onclick = "changeSearch(newSearch);">Search</button>
    </form>
	</div>
	</div>

	<div><div class = "newInfo" id = "Info"></div>
	<br>
	<img src = "https://i.imgur.com/cXz9gpv.jpg" id = "ImageInfo">
	<br>
	<div class = "newInfo1" id = "Info1"></div></div>
</body>
</html>
